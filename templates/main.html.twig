{% extends 'base.html.twig' %}
{% block body %}
    {% set currentSortColumn = sortParams.sortColumn.value %}
    {% set currentSortOrder = sortParams.sortDirection.value %}
    {% set columns = {
        name: 'Name'|trans,
        rating: '📈BGG'|trans,
        minPlayers: '👥Min'|trans,
        maxPlayers: '👥Max'|trans,
        minPlaytime: '⏳Min'|trans,
        maxPlaytime: '⌛️Max'|trans,
        averageWeight: '🏋🏋🏋',
        recommendedAge: '👶👴',
        yearPublished: '📅'
    } %}
    <!-- search form -->
    <section class="section">
        <form>
            <label>Nombre: <input name="gameName" value="{{ searchParams.gameName }}"/></label><br/>

            <label>Pueden Jugar:
                <input name="playerCount" value="{{ searchParams.playerCount }}"/></label><br/>

            <label>Max Jugadores:
                <input name="playerCount" value="{{ searchParams.exactPlayerCount }}"/></label><br/>

            <label>Duración Max:
                <input name="maxPlaytime" value="{{ searchParams.maxPlaytime }}"/></label><br/>

            <label>Duración Min:
                <input name="minPlaytime" value="{{ searchParams.minPlaytime }}"/></label><br/>

            <label>Peso Min:
                <input name="minWeight" value="{{ searchParams.minWeight }}"/></label><br/>

            <label>Peso Max:
                <input name="maxWeight" value="{{ searchParams.maxWeight }}"/></label><br/>

            <label>Edad Recomendada:
                <input name="recommendedAge" value="{{ searchParams.recommendedAge }}"/></label><br/>

            {% if currentSortColumn != 'name' or currentSortOrder != 'ASC' %}
                <input type="hidden" name="orderBy" value="{{ currentSortColumn }}">
                <input type="hidden" name="order" value="{{ currentSortOrder }}">
            {% endif %}
            <input type="submit" value="Buscar">
        </form>
    </section>

    <!-- game table -->
    <section class="section">
        <div class="container">
            <div class="b-table">
                <div class=" table-wrapper has-mobile-cards">
                    <table id='games' class="table is-striped is-hoverable is-fullwidth">
                        <!-- Header -->
                        <thead>
                        <tr>
                            <th class="is-chevron-cell"></th>
                            {% for key, label in columns %}
                                <th class="is-sortable {{ currentSortColumn == key ? 'is-current-sort' : '' }}">
                                    <a href="{{ libraryPath(key, currentSortOrder == 'DESC', searchParams) }}">{{ label }}</a>
                                    {% if currentSortColumn == key %}{{ currentSortOrder == 'ASC' ? '🔼' : '🔽' }}{% endif %}
                                </th>
                            {% endfor %}
                        </tr>
                        </thead>
                        <!-- Table Body -->
                        <tbody data-controller="details">
                        {% for game in games %}
                            <tr>
                                <td class="is-chevron-cell">
                                    <button data-action="details#toggle"
                                            data-details-bgg-id-param="{{ game.bggId }}">🔎
                                    </button>
                                </td>
                                <td data-label="{{ columns.name }}" class="title is-6">{{ game.name }}</td>
                                <td data-label="{{ columns.rating }}">{{ game.rating > 0 ? game.rating|round(1) : '❓' }}</td>
                                <td data-label="{{ columns.minPlayers }}">{{ game.minPlayers }}👤</td>
                                <td data-label="{{ columns.maxPlayers }}">{{ game.maxPlayers }}👤</td>
                                <td data-label="{{ columns.minPlaytime }}">{{ game.minPlaytime > 0 ? game.minPlaytime ~ "'" : '🤷‍️' }}</td>
                                <td data-label="{{ columns.maxPlaytime }}">{{ game.maxPlaytime > 0 ? game.maxPlaytime ~ "'" : '🤷‍️' }}</td>
                                <td data-label="{{ columns.averageWeight }}">{{ game.averageWeight > 0 ? game.averageWeight|round(1) : '❓' }}</td>
                                <td data-label="{{ columns.recommendedAge }}">{{ game.recommendedAge > 0 ? game.recommendedAge : '❌' }}</td>
                                <td data-label="{{ columns.yearPublished }}">{{ game.yearPublished > 0 ? game.yearPublished : '🤔' }}</td>
                            </tr>
                            <tr id="details-{{ game.bggId }}" class="detail" style="display: none">
                                <td colspan="8" class="is-size-7">
                                    <div class="detail-container">
                                        {% if game.mechanics is not empty %}
                                            <span class="title is-6">🛠</span>: {{ game.mechanics|join(', ') }}
                                        {% endif %}
                                        {% if game.categories is not empty %}
                                        <span class="title is-6">🧩</span>: {{ game.categories|join(', ') }}
                                        {% endif %}<br/>
                                        {% if game.designers is not empty %}
                                            <span class="title is-6">✍️</span>: {{ game.designers|join(', ') }}
                                        {% endif %}
                                        {% if game.publisher is not empty %}
                                            <span class="title is-6">🏭</span>: {{ game.publisher }}
                                        {% endif %}
                                        {% if game.expansions is not empty %}
                                            <span class="title is-6">⚙️</span> {{ game.expansions|join(', ') }}
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

{% endblock body %}
