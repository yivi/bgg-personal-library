{% extends 'base.html.twig' %}
{% block body %}
    {% set columns = {
        name: 'Nombre',
        rating: '📈BGG',
        minPlayers: '👥Min',
        maxPlayers: '👥Max',
        minPlaytime: '⏳Min',
        maxPlaytime: '⌛️Max',
        averageWeight: '🏋🏋🏋',
        recommendedAge: '👶👴',
        yearPublished: '📅'
    } %}
    <!-- search form -->

    <section class="section" data-controller="search">
        <article class="message is-info" id="searchBox">
            <div class="message-header" data-action="click->search#toggle">
                Mostrar búsqueda
                <button class="activator">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="message-body {{ searchParams.activeSearch ? '' :'is-hidden' }}">
                {{ form(form, {'action': path('library')}) }}
            </div>
        </article>
    </section>


    <!-- game table -->
    <section class="section">
        <!-- mobile sort navigation -->
        <div class="box is-hidden-tablet is-hidden-desktop" style="max-width: 900px" id="sortBox">
            <form action="{{ path('library') }}" method="get">
                <div class="select is-rounded is-small">
                    <select name="search_form[orderBy]">
                        {% for key, label in columns %}
                            <option value="{{ key }}" {{ key == searchParams.orderBy ? 'selected' : '' }}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="select is-rounded is-small">
                    <select name="search_form[order]">
                        <option value="ASC" {{ searchParams.order == 'ASC' ? 'selected' : '' }}>A...Z</option>
                        <option value="DESC" {{ searchParams.order != 'ASC' ? 'selected' : '' }}>Z...A</option>
                    </select>
                </div>

                <input class="button is-outlined is-small" type="submit" value="Ordenar">
                <input type="hidden" name="search_form[gameName]" value="{{ searchParams.gameName }}">
                <input type="hidden" name="search_form[playerCount]" value="{{ searchParams.playerCount }}">
                <input type="hidden" name="search_form[exactPlayerCount]" value="{{ searchParams.exactPlayerCount }}">
                <input type="hidden" name="search_form[maxPlaytime]" value="{{ searchParams.maxPlaytime }}">
                <input type="hidden" name="search_form[minPlaytime]" value="{{ searchParams.minPlaytime }}">
                <input type="hidden" name="search_form[minWeight]" value="{{ searchParams.minWeight }}">
                <input type="hidden" name="search_form[maxWeight]" value="{{ searchParams.maxWeight }}">
                <input type="hidden" name="search_form[recommendedAge]" value="{{ searchParams.recommendedAge }}">
            </form>
        </div>
        <div class="container">
            <div class="b-table">
                <div class=" table-wrapper has-mobile-cards">
                    <table id='games' class="table is-striped is-hoverable is-fullwidth">
                        <!-- Header -->
                        <thead>
                        <tr>
                            <th class="is-chevron-cell"></th>
                            {% for key, label in columns %}
                                <th class="is-sortable {{ searchParams.orderBy == key ? 'is-current-sort' : '' }}">
                                    <a href="{{ libraryPath(key, searchParams.order != 'ASC' and key == searchParams.orderBy, searchParams) }}">{{ label }}</a>
                                    {% if searchParams.orderBy == key %}{{ searchParams.order == 'ASC' ? '🔼' : '🔽' }}{% endif %}
                                </th>
                            {% endfor %}
                        </tr>
                        </thead>
                        <!-- Table Body -->
                        <tbody data-controller="details">
                        {% for game in games %}
                            <tr>
                                <td class="is-chevron-cell">
                                    <button data-action="details#toggle"
                                            data-details-bgg-id-param="{{ game.bggId }}">🔎
                                    </button>
                                </td>
                                <td data-label="{{ columns.name }}" class="title is-6">{{ game.name }}</td>
                                <td data-label="{{ columns.rating }}">{{ game.rating > 0 ? game.rating|round(1) : '❓' }}</td>
                                <td data-label="{{ columns.minPlayers }}">{{ game.minPlayers }}👤</td>
                                <td data-label="{{ columns.maxPlayers }}">{{ game.maxPlayers }}👤</td>
                                <td data-label="{{ columns.minPlaytime }}">{{ game.minPlaytime > 0 ? game.minPlaytime ~ "'" : '🤷‍️' }}</td>
                                <td data-label="{{ columns.maxPlaytime }}">{{ game.maxPlaytime > 0 ? game.maxPlaytime ~ "'" : '🤷‍️' }}</td>
                                <td data-label="{{ columns.averageWeight }}">{{ game.averageWeight > 0 ? game.averageWeight|round(1) : '❓' }}</td>
                                <td data-label="{{ columns.recommendedAge }}">{{ game.recommendedAge > 0 ? game.recommendedAge : '❌' }}</td>
                                <td data-label="{{ columns.yearPublished }}">{{ game.yearPublished > 0 ? game.yearPublished : '🤔' }}</td>
                            </tr>
                            <tr id="details-{{ game.bggId }}" class="detail" style="display: none">
                                <td colspan="10" class="is-size-7">
                                    <div class="detail-container">
                                        {% if game.mechanics is not empty %}
                                            <span class="title is-6">🛠</span>: {{ game.mechanics|join(', ') }}
                                        {% endif %}
                                        {% if game.categories is not empty %}
                                        <span class="title is-6">🧩</span>: {{ game.categories|join(', ') }}
                                        {% endif %}<br/>
                                        {% if game.designers is not empty %}
                                            <span class="title is-6">✍️</span>: {{ game.designers|join(', ') }}
                                        {% endif %}
                                        {% if game.publisher is not empty %}
                                            <span class="title is-6">🏭</span>: {{ game.publisher }}
                                        {% endif %}
                                        {% if game.expansions is not empty %}
                                            <span class="title is-6">⚙️</span> {{ game.expansions|join(', ') }}
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

{% endblock body %}
